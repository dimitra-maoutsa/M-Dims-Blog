{"title":"From PDEs to gradient flows for deterministic particle dynamics","markdown":{"yaml":{"author":"Dimitra Maoutsa","badges":true,"branch":"master","categories":["jupyter"],"date":"2022-11-02","description":"Introduction to deterministic particle methods for PDEs.","hide":false,"image":"images/landscape_r.png","metadata_key1":"particles","metadata_key2":"Wasserstein","metadata_key3":"probability_flow","output-file":"11_02-from_pdes_to_gradient_flows.html","search_exclude":false,"title":"From PDEs to gradient flows for deterministic particle dynamics","toc":true},"containsRefs":false,"markdown":"\n\n\n\n\n\nWe consider PDEs that describe the evolution of a density $\\rho_t(x)$ that evolves in time, with $x\\in \\mathcal{R}^D$. We describe the temporal evolution of the density $\\rho_t(x)$, e.g., a density of particles at location $x$.\nOne fundamental equation is the continuity equation, which prescribes how the the density $\\rho_t(x)$ evolves in time according to laws of mass conservation. In particular, the continuity equation declares that the time derivative of the density $\\rho_t(x)$ plus some velocity field $v$\n\\begin{equation}\n    \\partial_t \\rho_t(x) + \\nabla \\cdot \\left(  v(x,t) \\rho_t(x) \\right) = 0,\n\\end{equation}\ngiven some initial condition $\\rho_0(x) = \\rho^0(x)$. The velocity field in this equation prescribes spatial transformation of the density as time evolves, i.e., how a density of particles starting from $\\rho^0(x)$ moves according to the velocity field $v(x,t)$.\n\nThe continuity equation admits a useful discretisation in terms of particles. We can consider an associated ordinary differential equation. We can consider the evolution of $N$ particles in the Euclidean space, evolving according to the ODE\n\\begin{equation}\n    \\frac{dX_i(t)}{dt} = v(X_i(t),t) ,\n\\end{equation}\ngiven some initial conditions $X_i(0)$.\nThere is a close correspondence between this system of ODEs (the particles) and the solutions of the PDE. In particular, if the velocity field  is sufficiently nice (globally Lipschitz in space) , then as long as the iniital conditions of the particles are drawn from the density representing the initial condition of the PDE, i.e. if I take the empirical measure at each of these locations,\ni.e.,\n\\begin{equation}\n    \\hat{\\rho}_0 = \\frac{1}{N} \\sum^N_{i=1} \\delta(x-X_i(0)) \\xrightarrow{N \\rightarrow \\infty} \\rho_0(x),\n\\end{equation}\nthen the evolving locations of these Dirac masses converges according to the Wasserstein metric to the continuum solution of the PDE,\n\\begin{equation}\n    \\hat{\\rho}_t = \\frac{1}{N} \\sum^N_{i=1} \\delta(x-X_i(t)) \\xrightarrow{N \\rightarrow \\infty} \\rho_t(x),\n\\end{equation}\n\nBecause of this close connection between the PDEs and the particle representation a lot of PDEs have a natural discretisation in terms of particles.\nThe PDE conserves mass, i.e. whatever the integral of the initial data is that integral will be preserved over time. Also particle representation preserves positivity.\n\nIn general this equation is \\emph{not} a Wasserstein gradient flow for an arbitrary velocity field.\n\nThe difference between the transient empirical solution $\\hat{\\rho}_t$ and the exact solution $\\rho_t$ within the time interval $t \\in[0,T]$ will be bounded by a constant weighted by the initial distance of the initial condition\n\n\\begin{equation}\n    \\mathcal{W}_2(\\hat{\\rho}_t,\\rho_t) \\leq C_{T,\\|  \\nabla v\\|_{\\infty}} \\mathcal{W}_2(\\hat{\\rho}_0, \\rho_0)\n\\end{equation}\n\n\n\n##Fokker Planck equations as gradient flows\nAn equation that is a Wasserstein gradient flow and has attracted a lot of interest in the last years is the Fokker-Planck equation. It describes the evolution of a density according to adrift term\n\\begin{equation}\n    \\partial_t \\rho_t(x) = \\nabla \\cdot \\left( \\nabla V \\rho_t(x)\\right) + \\nabla \\nabla \\rho_t(x).\n\\end{equation}\nThis has an associated particle method, a stochastic one, because we have the diffusion present\n\\begin{equation}\n    dX_t = -V(X_t)dt + \\sqrt{2} dW_t\n\\end{equation}\nThe empirical measure represented in terms of particles will converge almost surely to the solution of the PDE.\n\n\nThis PDE has a corresponding particle discretisation. Each particle evolves according to this Ordinary differential equation.\n\nSince the density interacts with itself, the particles interact with each other through the second term.\n\nThis equation has a Wasserstein gradient flow structure. It is the gradient flow of this energy\n\\begin{equation}\n    \\mathcal{E}(\\rho) = \\int V(x) \\rho(x) dx + \\int \\rho(x) \\log \\rho(x) dx\n\\end{equation}\nit has an external potential term, and the second term is the negative entropy.\nThe particles are going at a direction negative of the gradient of the energy landscape for conservative systems, where the potential is small, to make the energy smaller. The diffusion term forces the density to spread out, so this term makes the entropy smaller.\n\nFokker-Planck equation can be viewed as a gradient flow. The central point of this idea is to define a manifold on which the Fokker-Planck system is a dynamical system on the manifold and evolving according to its gradient.\n\nBy understanding convexity properties of the function V that represents the potential can inform us about convexity properties of the energy landscape, and from there we can recover properties of the Fokker-Planck equation, i.e. contraction of solutions, exponential convergence to the equilibrium, etc.\n\nThe particle solution is not an Wasserstein gradient flow of this energy.\nThe reason for this is that I could write the PDE as a continuity type of equation\n\\begin{equation}\n    \\partial_t \\rho_t(x) = \\nabla \\cdot \\left[ \\underbrace{( \\nabla V + \\frac{\\nabla \\rho}{\\rho})}_{\\text{velocity field:} v(x,t)} \\rho \\right]\n\\end{equation}\nBut this is a weird velocity field and for a general density the particle method will not be well defined.\nDue to the diffusion the instantaneous Dirac masses will not remain Dirac masses.\n\n\nThe Wasserstein space is the space of probability measures on $\\mathcal{R}^N$ with the metric induced by the Wasserstein distance.\n\nThe seminal work of Jordan-Kinderlehrer-Otto~\\cite{jordan1998variational} established the view of the Fokker--Planck equation as a gradient flow of the Kullback Leibler divergence functional on a probability space equipped with a Wasserstein metric.\nThe solution of the Fokker--Planck equation with drift forces arising as a gradient of a potential $V(x)$, i.e., $f(x)=\\nabla V(x)$ was identified as the gradient flow of the free energy with respect to the Wasserstein metric. For a gradient system, the free energy difference between two states $\\delta F$ amounts to the negative entropy production times the temperature $\\delta F = - \\mathcal{T} \\mathcal{S}$, where $\\mathcal{S}$ stands for the entropy production. Thus this formulation may be viewed as a maximum entropy principle for the Fokker Planck.\n\nThe Fokker-Planck equation can be viewed as as the gradient flow in the Wasserstein metric of the relative entropy functional\n\\begin{equation}\n    S(\\rho) = \\int_{\\mathcal{R}^d} \\rho(x) \\log\\left( \\frac{\\rho(x)}{e^{-V(x)}} \\right)dx.\n\\end{equation}\n\nMajor computational challenge of the jko scheme is how to computationally efficiently compute the optimal trnasport cost.\n\nThe optimal transport yields geodesics in the Wasserstein space [cite Villani old and new]. The evolution of the probability density described by the Fokker--Planck equation amounts to the a curve in the Wasserstein space, the actual length of this curve is identified as the distance between the initial and the terminal points if this curve is a geodesic. All other curves the connect the two measures have larger dissipation.\nOptimal transport protocols correspond to geodesics in the Wasserstein space and can be employed in an equivalent definition of curvature.\n","srcMarkdownNoYaml":"\n\n\n\n\n\nWe consider PDEs that describe the evolution of a density $\\rho_t(x)$ that evolves in time, with $x\\in \\mathcal{R}^D$. We describe the temporal evolution of the density $\\rho_t(x)$, e.g., a density of particles at location $x$.\nOne fundamental equation is the continuity equation, which prescribes how the the density $\\rho_t(x)$ evolves in time according to laws of mass conservation. In particular, the continuity equation declares that the time derivative of the density $\\rho_t(x)$ plus some velocity field $v$\n\\begin{equation}\n    \\partial_t \\rho_t(x) + \\nabla \\cdot \\left(  v(x,t) \\rho_t(x) \\right) = 0,\n\\end{equation}\ngiven some initial condition $\\rho_0(x) = \\rho^0(x)$. The velocity field in this equation prescribes spatial transformation of the density as time evolves, i.e., how a density of particles starting from $\\rho^0(x)$ moves according to the velocity field $v(x,t)$.\n\nThe continuity equation admits a useful discretisation in terms of particles. We can consider an associated ordinary differential equation. We can consider the evolution of $N$ particles in the Euclidean space, evolving according to the ODE\n\\begin{equation}\n    \\frac{dX_i(t)}{dt} = v(X_i(t),t) ,\n\\end{equation}\ngiven some initial conditions $X_i(0)$.\nThere is a close correspondence between this system of ODEs (the particles) and the solutions of the PDE. In particular, if the velocity field  is sufficiently nice (globally Lipschitz in space) , then as long as the iniital conditions of the particles are drawn from the density representing the initial condition of the PDE, i.e. if I take the empirical measure at each of these locations,\ni.e.,\n\\begin{equation}\n    \\hat{\\rho}_0 = \\frac{1}{N} \\sum^N_{i=1} \\delta(x-X_i(0)) \\xrightarrow{N \\rightarrow \\infty} \\rho_0(x),\n\\end{equation}\nthen the evolving locations of these Dirac masses converges according to the Wasserstein metric to the continuum solution of the PDE,\n\\begin{equation}\n    \\hat{\\rho}_t = \\frac{1}{N} \\sum^N_{i=1} \\delta(x-X_i(t)) \\xrightarrow{N \\rightarrow \\infty} \\rho_t(x),\n\\end{equation}\n\nBecause of this close connection between the PDEs and the particle representation a lot of PDEs have a natural discretisation in terms of particles.\nThe PDE conserves mass, i.e. whatever the integral of the initial data is that integral will be preserved over time. Also particle representation preserves positivity.\n\nIn general this equation is \\emph{not} a Wasserstein gradient flow for an arbitrary velocity field.\n\nThe difference between the transient empirical solution $\\hat{\\rho}_t$ and the exact solution $\\rho_t$ within the time interval $t \\in[0,T]$ will be bounded by a constant weighted by the initial distance of the initial condition\n\n\\begin{equation}\n    \\mathcal{W}_2(\\hat{\\rho}_t,\\rho_t) \\leq C_{T,\\|  \\nabla v\\|_{\\infty}} \\mathcal{W}_2(\\hat{\\rho}_0, \\rho_0)\n\\end{equation}\n\n\n\n##Fokker Planck equations as gradient flows\nAn equation that is a Wasserstein gradient flow and has attracted a lot of interest in the last years is the Fokker-Planck equation. It describes the evolution of a density according to adrift term\n\\begin{equation}\n    \\partial_t \\rho_t(x) = \\nabla \\cdot \\left( \\nabla V \\rho_t(x)\\right) + \\nabla \\nabla \\rho_t(x).\n\\end{equation}\nThis has an associated particle method, a stochastic one, because we have the diffusion present\n\\begin{equation}\n    dX_t = -V(X_t)dt + \\sqrt{2} dW_t\n\\end{equation}\nThe empirical measure represented in terms of particles will converge almost surely to the solution of the PDE.\n\n\nThis PDE has a corresponding particle discretisation. Each particle evolves according to this Ordinary differential equation.\n\nSince the density interacts with itself, the particles interact with each other through the second term.\n\nThis equation has a Wasserstein gradient flow structure. It is the gradient flow of this energy\n\\begin{equation}\n    \\mathcal{E}(\\rho) = \\int V(x) \\rho(x) dx + \\int \\rho(x) \\log \\rho(x) dx\n\\end{equation}\nit has an external potential term, and the second term is the negative entropy.\nThe particles are going at a direction negative of the gradient of the energy landscape for conservative systems, where the potential is small, to make the energy smaller. The diffusion term forces the density to spread out, so this term makes the entropy smaller.\n\nFokker-Planck equation can be viewed as a gradient flow. The central point of this idea is to define a manifold on which the Fokker-Planck system is a dynamical system on the manifold and evolving according to its gradient.\n\nBy understanding convexity properties of the function V that represents the potential can inform us about convexity properties of the energy landscape, and from there we can recover properties of the Fokker-Planck equation, i.e. contraction of solutions, exponential convergence to the equilibrium, etc.\n\nThe particle solution is not an Wasserstein gradient flow of this energy.\nThe reason for this is that I could write the PDE as a continuity type of equation\n\\begin{equation}\n    \\partial_t \\rho_t(x) = \\nabla \\cdot \\left[ \\underbrace{( \\nabla V + \\frac{\\nabla \\rho}{\\rho})}_{\\text{velocity field:} v(x,t)} \\rho \\right]\n\\end{equation}\nBut this is a weird velocity field and for a general density the particle method will not be well defined.\nDue to the diffusion the instantaneous Dirac masses will not remain Dirac masses.\n\n\nThe Wasserstein space is the space of probability measures on $\\mathcal{R}^N$ with the metric induced by the Wasserstein distance.\n\nThe seminal work of Jordan-Kinderlehrer-Otto~\\cite{jordan1998variational} established the view of the Fokker--Planck equation as a gradient flow of the Kullback Leibler divergence functional on a probability space equipped with a Wasserstein metric.\nThe solution of the Fokker--Planck equation with drift forces arising as a gradient of a potential $V(x)$, i.e., $f(x)=\\nabla V(x)$ was identified as the gradient flow of the free energy with respect to the Wasserstein metric. For a gradient system, the free energy difference between two states $\\delta F$ amounts to the negative entropy production times the temperature $\\delta F = - \\mathcal{T} \\mathcal{S}$, where $\\mathcal{S}$ stands for the entropy production. Thus this formulation may be viewed as a maximum entropy principle for the Fokker Planck.\n\nThe Fokker-Planck equation can be viewed as as the gradient flow in the Wasserstein metric of the relative entropy functional\n\\begin{equation}\n    S(\\rho) = \\int_{\\mathcal{R}^d} \\rho(x) \\log\\left( \\frac{\\rho(x)}{e^{-V(x)}} \\right)dx.\n\\end{equation}\n\nMajor computational challenge of the jko scheme is how to computationally efficiently compute the optimal trnasport cost.\n\nThe optimal transport yields geodesics in the Wasserstein space [cite Villani old and new]. The evolution of the probability density described by the Fokker--Planck equation amounts to the a curve in the Wasserstein space, the actual length of this curve is identified as the distance between the initial and the terminal points if this curve is a geodesic. All other curves the connect the two measures have larger dissipation.\nOptimal transport protocols correspond to geodesics in the Wasserstein space and can be employed in an equivalent definition of curvature.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"output-file":"11_02-from_pdes_to_gradient_flows.html","toc":true},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.29","theme":["cosmo","brand"],"title-block-banner":true,"author":"Dimitra Maoutsa","badges":true,"branch":"master","categories":["jupyter"],"date":"2022-11-02","description":"Introduction to deterministic particle methods for PDEs.","hide":false,"image":"images/landscape_r.png","metadata_key1":"particles","metadata_key2":"Wasserstein","metadata_key3":"probability_flow","search_exclude":false,"title":"From PDEs to gradient flows for deterministic particle dynamics"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}